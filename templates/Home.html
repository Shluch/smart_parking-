<!doctype html>
<html class="no-js" lang="en">

<head>
	<meta http-equiv="refresh" content="10">
    <!-- meta data -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!--font-family-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rufina:400,700" rel="stylesheet">
    
    <!-- title of site -->
    <title>Park Me</title>

    <!-- For favicon png -->
    <link rel="shortcut icon" type="image/icon" href="{{ url_for('static', filename='logo/favicon.png') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sloth.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/excel.css') }}">

       
    <!--font-awesome.min.css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">

    <!--linear icon css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/linearicons.css') }}">

    <!--flaticon.css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/flaticon.css') }}">

    <!--animate.css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animate.css') }}">

    <!--owl.carousel.css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.carousel.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/owl.theme.default.min.css') }}">
		
    <!--bootstrap.min.css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
		
    <!-- bootsnav -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootsnav.css') }}">
        
    <!--style.css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        
    <!--responsive.css-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
        
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

	
	<body>
		<!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->
	
		<!--welcome-hero start -->
		<section id="home" class="welcome-hero">

			<!-- top-area Start -->
			<div class="top-area">
				<div class="header-area">
					<!-- Start Navigation -->
				    <nav class="navbar navbar-default bootsnav  navbar-sticky navbar-scrollspy"  data-minus-value-desktop="70" data-minus-value-mobile="55" data-speed="1000">

				        <div class="container">

				            <!-- Start Header Navigation -->
				            <div class="navbar-header">
				                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-menu">
				                    <i class="fa fa-bars"></i>
				                </button>
				                <a class="navbar-brand" href="index.html">Park Me<span></span></a>

				            </div><!--/.navbar-header-->
				            <!-- End Header Navigation -->

				            <!-- Collect the nav links, forms, and other content for toggling -->
				            <div class="collapse navbar-collapse menu-ui-design" id="navbar-menu">
				                <ul class="nav navbar-nav navbar-right" data-in="fadeInDown" data-out="fadeOutUp">
				                    <li class=" scroll active"><a href="#home">New User ?</a></li>
				                    <li class="scroll"><a href="#service">Slot Booking</a></li>
									<li class="scroll"><a href="#new-cars">Records</a></li>
				                    <li class="scroll"><a href="#featured-cars">User Data</a></li>
				                    
				                </ul><!--/.nav -->
				            </div><!-- /.navbar-collapse -->
				        </div><!--/.container-->
				    </nav><!--/nav-->
				    <!-- End Navigation -->
				</div><!--/.header-area-->
			    <div class="clearfix"></div>

			</div><!-- /.top-area-->
			<!-- top-area End -->

			<div class="container">
				<div class="welcome-hero-txt">
					<h2>Not registered?</h2>
					<p>
						Sign up now and park hassle-free in seconds!
					</p>
					<button class="welcome-btn" onclick="window.location.href='{{ url_for('register') }}'">Register</button>

				</div>
			</div>

			<div class="container">
				<div class="row">
					<div class="col-md-12">

					</div>
				</div>
			</div>

		</section><!--/.welcome-hero-->
		<!--welcome-hero end -->

		<!--service start -->
		<body>
			<section id="service" class="service">
				<div class="container">
				  <div class="service-content">
					<h2>Parking Slot Booking</h2>
					<!-- This div will hold the 20 parking slots -->
					<div id="slots">
						{% for slot, status in slot_statuses.items() %}
							<div class="slot {{ 'available' if status == '0' else 'booked' }}" id="{{ slot }}">
								{{ slot }}
							</div>
						{% endfor %}
					</div>
				  </div>
				</div><!--/.container-->
			  </section><!--/.service-->
			  <script>
				const parkUrl = "{{ url_for('park') }}";
			  </script>
			      <script>
					document.addEventListener("DOMContentLoaded", function() {
						const slots = document.querySelectorAll('.slot');
						slots.forEach(slot => {
							slot.addEventListener('click', function() {
								if (this.classList.contains('available')) {
									const slotNumber = this.id.replace('slot', '');
									window.location.href = `/park?slot=${slotNumber}`;
								} else {
									alert("This slot is already booked.");
								}
							});
						});
					});
				</script>
			  <!-- Include the JS that creates the 20 slots -->
			  <!-- <script src="{{ url_for('static', filename='js/sloth.js') }}"></script> -->
			   </body>
		<!--service end-->

		<!--new-cars start -->
		<section id="new-cars" class="new-cars">
			<div class="container">
				<div class="section-header">
					<p>Todays <span>parking</span>Records</p>
					<h2>24 hr</h2>
					<button id="clear-button">Clear List</button>

				</div><!--/.section-header-->
				<div id="home-dashboard">
					
				
					<!-- Somewhere above your table -->
<button id="clear-button">Clear List</button>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Phone</th>
      <th>Adhaar</th>
      <th>Vehicle</th>
      <th>Slot</th>
      <th>Event Type</th>
      <th>Event Time</th>
    </tr>
  </thead>
  <tbody>
    {% if event_data %}
      {% for row in event_data %}
        <tr>
          <td>{{ row.id }}</td>
          <td>{{ row.name }}</td>
          <td>{{ row.phone }}</td>
          <td>{{ row.adhaar }}</td>
          <td>{{ row.vehicle }}</td>
          <td>{{ row.slot }}</td>
          <td>{{ row.event_type }}</td>
          <td>{{ row.event_time }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="8">No parking log data available.</td></tr>
    {% endif %}
  </tbody>
</table>

<script>
// Function to filter out rows older than the last clear time.
function filterRows() {
  let lastClearTimeStr = localStorage.getItem('lastClearTime');
  if (!lastClearTimeStr) return;
  
  let lastClearTime = new Date(lastClearTimeStr);
  const rows = document.querySelectorAll("tbody tr");

  rows.forEach(row => {
    // Assumes the last cell contains the event_time in "YYYY-MM-DD HH:MM:SS" format.
    let eventTimeCell = row.querySelector("td:last-child");
    if (eventTimeCell) {
      let eventTime = new Date(eventTimeCell.textContent);
      // If the event time is before the clear time, remove the row.
      if (eventTime < lastClearTime) {
        row.remove();
      }
    }
  });
}

// Run the filter when the DOM content is loaded.
window.addEventListener('DOMContentLoaded', filterRows);

// Attach event listener to the "Clear List" button.
document.getElementById("clear-button").addEventListener("click", function() {
  let now = new Date();
  // Store the current time as the "clear" time.
  localStorage.setItem('lastClearTime', now.toISOString());

  // Immediately clear the visible rows.
  const rows = document.querySelectorAll("tbody tr");
  rows.forEach(row => {
    let eventTimeCell = row.querySelector("td:last-child");
    if (eventTimeCell) {
      let eventTime = new Date(eventTimeCell.textContent);
      if (eventTime < now) {
        row.remove();
      }
    }
  });
});
</script>

						
				  </div>
			</div><!--/.container-->

		</section><!--/.new-cars-->
		<!--new-cars end -->

		<!--featured-cars start -->
		<section id="featured-cars" class="featured-cars">
			<div class="container">
				<div class="section-header">
					<p>checkout <span>the</span> users</p>
					<h2>Current Registered Users</h2>
				</div><!--/.section-header-->
				<div id="home-dashboard">
					{% if registered_data %}
					  <table>
						<thead>
						  <tr>
							<th>ID</th>
							<th>Name</th>
							<th>Phone</th>
							<th>Adhaar</th>
							<th>Vehicle</th>
							
						  </tr>
						</thead>
						<tbody>
						  {% for row in registered_data %}
							<tr>
							  <td>{{ row.id }}</td>
							  <td>{{ row.name }}</td>
							  <td>{{ row.phone }}</td>
							  <td>{{ row.adhaar }}</td>
							  <td>{{ row.vehicle }}</td>
							</tr>
						  {% endfor %}
						</tbody>
					  </table>
					{% else %}
					  <p>No registered users data available.</p>
					{% endif %}
				</div>
			</div><!--/.container-->

		</section><!--/.featured-cars-->
		<!--featured-cars end -->



		
		<!-- Include all js compiled plugins (below), or include individual files as needed -->

		<script src="{{ url_for('static', filename='js/jquery.js') }}"></script>

		<!-- modernizr.min.js -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
		
		<!-- bootstrap.min.js -->
		<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
		
		<!-- bootsnav js -->
		<script src="{{ url_for('static', filename='js/bootsnav.js') }}"></script>
		
		<!-- owl.carousel.js -->
		<script src="{{ url_for('static', filename='js/owl.carousel.min.js') }}"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
		
		<!-- Custom JS -->
		<script src="{{ url_for('static', filename='js/custom.js') }}"></script>
		
        
    </body>
	
</html>